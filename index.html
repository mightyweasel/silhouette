<!DOCTYPE html>
<html>

<head>
  <!-- Code from d3-graph-gallery.com -->
  <meta charset="utf-8">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>
  <style>
    html,
    body {
      font-family: 'Open Sans', sans-serif;
      vertical-align: top;
    }

    .flbox {
      display: flex;
      align-items: flex-start;
    }
  </style>
</head>

<body>
  <!-- Create a div where the graph will take place -->
  <div class="flbox">
    <div>
      <h1>Organizational Silhouette</h1>
      <div>
        <label for="org_delta">Select Organization</label>
        <select id="org_delta" name="org_delta">
          <option value="All" selected>All Orgs</option>
          <option value="CSPS">CSPS</option>
          <option value="ESDC">ESDC</option>
        </select>
      </div>
      <p>
        This is a collection of results respresenting what folks think the core personality/focus of the
        department or organization actually is. Nothing official, just what the general "vox pop" thinks.
      </p>
      <h2>Interesting Metrics</h2>
      <ul>
        <li>47% of respondents think <strong>Policy</strong> is key</li>
        <li>Highest coverage is in <strong>risks</strong></li>
        <li>Least coverage is in <strong>national security</strong></li>
      </ul>
      <h2>Opportunities</h2>
      <p>
        If you're interested in growing your career in the folowwing dimensions <strong>CSPS</strong> would be
        a great place to check out if you want more experience in
      </p>
      <ul>
        <li>Developing <strong>learning plans</strong></li>
        <li>Working with <strong>policy and economics</strong></li>
        <li>Having a broad mandate to do things</li>
      </ul>
      <h2>Details</h2>
      <p>
        This data was generated by aggregating the thoughts of <strong>130</strong> public servants from
        across <strong>8</strong> departments
      </p>
    </div>
    <div>
      <h2>CSPS Avg. Silhouette</h2>
      <div id="my_dataviz"></div>
    </div>
  </div>

  <script>

    /*
    X axis (Policy Objective)
    - Policy Areas (Economic, Social, Internation, National Security and Public Safety)
    - Econ (Trade, Agriculture, Transpo)
    - Social (Health, Vets, Indian Affairs)
    - Intl ()
    - NS (Cyber, Terrorism, Crime)
 
    - IN each area (easy, mid, hard, wicked problems)
    - Similar on the Biz side:
 
    Y axis (Business Function, Public Admin Access)
    - Services (Indiv and Biz)
    - Grants and COntribu
    - Regulation
    - Science
    - Policy
    */


    // X Axis
    var myGroupsTest = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L"]
    var myGroupsReal = [
      // Policy
      "Policy (Economic)",
      "Policy (Social)",
      "Policy (International)",
      "Policy (National Security and Public Safety)",
      // Econ
      "Economics (Trade)",
      "Economics (Agriculture)",
      "Economics (Transporation)",
      // Social
      "Social (Health)",
      "Social (Veterans Affairs)",
      "Social (Indigenous Affairs)",
      // International
      "International",
      // National Security
      "National Security (Cyber)",
      "National Security (Terrorism)",
      "National Security (Crime)"
    ];
    // Y Axis
    var myVarsTest = ["v0", "v1", "v2", "v3", "v4", "v5"]
    var myVarsReal = [
      "Services (Individuals)",
      "Services (Businesses)",
      "Grants and Contributions",
      "Regulation",
      "Science",
      "Policy"
    ];
    //Read the data
    var test_data_opts = [
      "test_data",
      "test_just_x1ya",
      "test_full"
    ];
    // connections
    var server_conn_opts = [
      "https://raw.githubusercontent.com/mightyweasel/silhouette/master/",
      "http://localhost:8888/"
    ];
    // usage variables
    var server_conn = server_conn_opts[1]; // 0 prod, 1 dev
    var test_data = test_data_opts[0]; // sample data
    var myGroups = myGroupsReal; // set the dataset
    var myVars = myVarsReal; // set the dataset


    function show_selected() {
      var selector = document.getElementById('org_delta');
      var value = selector[selector.selectedIndex].value;
      if (value == "CSPS") {
        test_data = "test_data_CSPS";
      } else if (value == "ESDC") {
        test_data = "test_data_ESDC";
      } else {
        test_data = test_data_opts[0];
      }

      graph_it();
    }


    function graph_it() {
      console.log("Charting: " + test_data);
      // set the dimensions and margins of the graph
      var margin = { top: 30, right: 30, bottom: 200, left: 200 },
        width = 800 - margin.left - margin.right,
        height = 750 - margin.top - margin.bottom;

      // append the svg object to the body of the page
      d3.select("svg").remove();
      var svg = d3.select("#my_dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

      // Build X scales and axis:
      var x = d3.scaleBand()
        .range([0, width])
        .domain(myGroups)
        .padding(0.02);
      svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x))
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-65)");

      // Build X scales and axis:
      var y = d3.scaleBand()
        .range([height, 0])
        .domain(myVars)
        .padding(0.01);
      svg.append("g")
        .call(d3.axisLeft(y));

      // Build color scale
      var myColor = d3.scaleLinear()
        .range(["white", "#69b3a2"])
        .domain([1, 100])

      d3.csv(server_conn + "datasets/" + test_data + ".csv", function (data) {
        svg.selectAll()
          .data(data, function (d) { return d.group + ':' + d.variable; })
          .enter()
          .append("rect")
          .attr("x", function (d) { return x(d.group) })
          .attr("y", function (d) { return y(d.variable) })
          .attr("width", x.bandwidth())
          .attr("height", y.bandwidth())
          .style("fill", function (d) { return myColor(d.value) })

      })
    }

    // add listeners
    document.getElementById('org_delta').addEventListener('change', show_selected);
    graph_it();
  </script>
</body>

</html>