<!DOCTYPE html>
<html>

<head>
  <!-- Code from d3-graph-gallery.com -->
  <meta charset="utf-8">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>
  <style>
    html,
    body {
      font-family: 'Open Sans', sans-serif;
      vertical-align: top;
    }

    .flbox {
      display: flex;
      align-items: flex-start;
    }
  </style>
</head>

<body>
  <!-- Create a div where the graph will take place -->
  <div class="flbox">
    <div>
      <h1>Organizational Silhouette</h1>
      <div>
        <label for="org_delta">Select Organization</label>
        <select id="org_delta" name="org_delta">
          <option value="All" selected>All Orgs</option>
          <option value="CSPS">CSPS</option>
          <option value="ESDC">ESDC</option>
        </select>
      </div>
      <p>
        This is a collection of results respresenting what folks think the core personality/focus of the
        department or organization actually is. Nothing official, just what the general "vox pop" thinks.
      </p>
      <h2>Interesting Metrics</h2>
      <ul>
        <li>47% of respondents think <strong>Policy</strong> is key</li>
        <li>Highest coverage is in <strong>risks</strong></li>
        <li>Least coverage is in <strong>national security</strong></li>
      </ul>
      <h2>Opportunities</h2>
      <p>
        If you're interested in growing your career in the folowwing dimensions <strong>CSPS</strong> would be
        a great place to check out if you want more experience in
      </p>
      <ul>
        <li>Developing <strong>learning plans</strong></li>
        <li>Working with <strong>policy and economics</strong></li>
        <li>Having a broad mandate to do things</li>
      </ul>
      <h2>Details</h2>
      <p>
        This data was generated by aggregating the thoughts of <strong>130</strong> public servants from
        across <strong>8</strong> departments
      </p>
    </div>
    <div>
      <h2>CSPS Avg. Silhouette</h2>
      <div id="heatmap_cont">
        <div id="heatmap_svg"></div>
      </div>
    </div>
  </div>

  <script>

    /*
    X axis (Policy Objective)
    - Policy Areas (Economic, Social, Internation, National Security and Public Safety)
    - Econ (Trade, Agriculture, Transpo)
    - Social (Health, Vets, Indian Affairs)
    - Intl ()
    - NS (Cyber, Terrorism, Crime)
 
    - IN each area (easy, mid, hard, wicked problems)
    - Similar on the Biz side:
 
    Y axis (Business Function, Public Admin Access)
    - Services (Indiv and Biz)
    - Grants and COntribu
    - Regulation
    - Science
    - Policy

    // Submit Org Profile (Your Org -> Profiled Org)
    // Create a desired profile (local)
    // Match profile against Org Profiles for match
    // Create metrics from org data
    // Store data



    */


    // X Axis
    var myGroups = [
      "[Economic] Agriculture",
      "[Economic] Fisheries",
      "[Economic] Natural Resources",
      "[Economic] Environment, Climate Change, and Energy",
      "[Economic] Innovation",
      "[Economic] Regional Development",
      "[Economic] Transportation",
      "[Economic] Inclusive Growth Opportunities and Innovation",
      "[Social] Indigenous Affairs",
      "[Social] Justice",
      "[Social] Health",
      "[Social] Labour Market",
      "[Social] Income Security",
      "[Social] Heritage",
      "[Social] Immigration",
      "[Social] Veterans",
      "[Social] Status of Women",
      "[Social] Diversity and Inclusion",
      "[International] Foreign",
      "[International] Trade",
      "[International] International Development",
      "[Public Safety] Defence",
      "[Public Safety] Public Safety",
      "[Public Safety] National Security"
    ];
    // Y Axis
    var myVars = [
      "[Services] To Individuals",
      "[Services] To Businesss",
      "[Services] To Public",
      "[Transfers] Grants and Contributions",
      "[Transfers] Contracts",
      "[Transfers] New Instruments",
      "[Regulations] Risk Assessment",
      "[Regulations] Prescriptions",
      "[Regulations] Outcomes and Systems-based",
      "[Regulations] Verifications and Enforcement",
      "[Science] Research",
      "[Science] Applied Research",
      "[Science] Scientific Services",
      "[Policy] Issue Management",
      "[Policy] Priorities Management",
      "[Policy] Policy Research",
      "[Policy] Medium-term planning",
      "[Internal] IM/IT",
      "[Internal] Human Resources",
      "[Internal] Financial/Procurement",
      "[Internal] Communications",
      "[Internal] Audit/Evaluation"
    ];


    function print_xy_combinations() {
      var str = "";
      for (var i = 0; i < myGroups.length; i++) {
        for (var j = 0; j < myVars.length; j++) {
          str += myGroups[i] + "," + myVars[j] + "," + (Math.floor(100 * Math.random())) + "\n";
        }
      }
      console.log(str);
    }
    print_xy_combinations();

    //Read the data
    var test_data_opts = [
      "test_data",
      "test_data_CSPS",
      "test_data_ESDC"
      // other tests
    ];
    // connections
    var server_conn_opts = [
      "https://raw.githubusercontent.com/mightyweasel/silhouette/master/",
      "http://localhost:8888/"
    ];
    // usage variables
    var server_conn = server_conn_opts[1]; // 0 prod, 1 dev
    var test_data = test_data_opts[0]; // sample data


    var margin = { top: 30, right: 30, bottom: 200, left: 200 },
      width = 800 - margin.left - margin.right,
      height = 750 - margin.top - margin.bottom;

    function show_selected() {
      var selector = document.getElementById('org_delta');
      var value = selector[selector.selectedIndex].value;
      // test values
      if (value == "CSPS") {
        test_data = "test_data_CSPS";
      } else if (value == "ESDC") {
        test_data = "test_data_ESDC";
      } else {
        test_data = test_data_opts[0];
      }
      d3.select("svg").remove();
      document.getElementById('heatmap_svg').innerHTML = "";
      graph_it();
    }


    function graph_it() {
      //console.log("Charting: " + test_data);
      // set the dimensions and margins of the graph


      // append the svg object to the body of the page

      var svg = d3.select("#heatmap_svg")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

      // Build X scales and axis:
      var x = d3.scaleBand()
        .range([0, width])
        .domain(myGroups)
        .padding(0.02);
      svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x))
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-65)");

      // Build X scales and axis:
      var y = d3.scaleBand()
        .range([height, 0])
        .domain(myVars)
        .padding(0.01);
      svg.append("g")
        .call(d3.axisLeft(y));

      // Build color scale
      var myColor = d3.scaleLinear()
        .range(["white", "#69b3a2"])
        .domain([1, 100])

      // create a tooltip
      var tooltip = d3.select("#heatmap_svg")
        .append("div")
        .style("opacity", 0)
        .attr("class", "tooltip")
        .style("background-color", "white")
        .style("border", "solid")
        .style("border-width", "2px")
        .style("border-radius", "5px")
        .style("padding", "5px")
      // Three function that change the tooltip when user hover / move / leave a cell
      var mouseover = function (d) {
        tooltip.style("opacity", 1)
      }
      var mousemove = function (d) {
        tooltip
          .html("Count: " + d.value)
          .style("position", "absolute")
          .style("left", (d3.mouse(this)[0]) + document.getElementById("heatmap_svg").offsetLeft + 100 + "px")
          .style("top", (d3.mouse(this)[1]) + document.getElementById("heatmap_svg").offsetTop + "px")
      }
      var mouseleave = function (d) {
        tooltip.style("opacity", 0)
      }

      d3.csv(server_conn + "datasets/" + test_data + ".csv", function (data) {
        svg.selectAll()
          .data(data, function (d) { return d.group + ':' + d.variable; })
          .enter()
          .append("rect")
          .attr("x", function (d) { return x(d.group) })
          .attr("y", function (d) { return y(d.variable) })
          .attr("rx", 4)
          .attr("ry", 4)
          .attr("width", x.bandwidth())
          .attr("height", y.bandwidth())
          .style("fill", function (d) { return myColor(d.value) })
          .on("mouseover", mouseover)
          .on("mousemove", mousemove)
          .on("mouseleave", mouseleave)
      })
    }

    // add listeners
    document.getElementById('org_delta').addEventListener('change', show_selected);
    graph_it();
  </script>
</body>

</html>